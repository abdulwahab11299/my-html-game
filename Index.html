<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Galaxy Shooter</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      font-family: sans-serif;
    }
    canvas {
      display: block;
      background: #000;
      border: 2px solid white;
      margin: 0 auto;
      touch-action: none;
    }
    #hud {
      color: white;
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 16px;
      z-index: 1;
    }
  </style>
</head>
<body>
  <div id="hud">Score: 0 | Level: 1 | Boss Health: 0 | Health: 3</div>
  <canvas id="gameCanvas"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const hud = document.getElementById("hud");

    // Canvas size
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    let score = 0, level = 1;
    let bullets = [], enemies = [], powerUps = [], healthPowerUps = [];
    let canShoot = true;
    let boss = null, bossHealth = 0;
    let touchStartX = 0;
    let isFiring = false;
    let playerHealth = 3; // Player Health
    let collisionCount = 0; // Count how many times player collided

    const spaceship = {
      width: 50,
      height: 50,
      x: canvas.width / 2 - 25,
      y: canvas.height - 80,
      speed: 7
    };

    // Fire when touched
    canvas.addEventListener("touchstart", e => {
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const x = touch.clientX - rect.left;
      const y = touch.clientY - rect.top;

      // Check if touch is on spaceship
      if (
        x > spaceship.x &&
        x < spaceship.x + spaceship.width &&
        y > spaceship.y &&
        y < spaceship.y + spaceship.height
      ) {
        isFiring = true;
        touchStartX = x - spaceship.x;
      }
    });

    canvas.addEventListener("touchend", () => {
      isFiring = false;
    });

    canvas.addEventListener("touchmove", e => {
      e.preventDefault();
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const x = touch.clientX - rect.left;

      spaceship.x = x - touchStartX;

      if (spaceship.x < 0) spaceship.x = 0;
      if (spaceship.x + spaceship.width > canvas.width)
        spaceship.x = canvas.width - spaceship.width;
    });

    function fireBullet() {
      if (canShoot && isFiring) {
        if (playerHasPowerUp("double")) {
          bullets.push({ x: spaceship.x + spaceship.width / 2 - 2.5, y: spaceship.y });
          bullets.push({ x: spaceship.x + spaceship.width / 2 - 2.5, y: spaceship.y, dir: 1 }); // Additional bullet
        } else if (playerHasPowerUp("triple")) {
          bullets.push({ x: spaceship.x + spaceship.width / 2 - 2.5, y: spaceship.y });
          bullets.push({ x: spaceship.x + spaceship.width / 2 - 2.5, y: spaceship.y, dir: 1 });
          bullets.push({ x: spaceship.x + spaceship.width / 2 - 2.5, y: spaceship.y, dir: -1 });
        } else {
          bullets.push({ x: spaceship.x + spaceship.width / 2 - 2.5, y: spaceship.y });
        }
        canShoot = false;
        setTimeout(() => (canShoot = true), 250);
      }
    }

    function playerHasPowerUp(type) {
      return powerUps.includes(type);
    }

    function drawSpaceship() {
      ctx.fillStyle = "white";
      ctx.fillRect(spaceship.x, spaceship.y, spaceship.width, spaceship.height);
    }

    function drawBullets() {
      ctx.fillStyle = "red";
      bullets.forEach((b, i) => {
        b.y -= 10;
        if (b.dir === 1) b.x += 5; // Right bullet
        else if (b.dir === -1) b.x -= 5; // Left bullet
        ctx.fillRect(b.x, b.y, 5, 10);
        if (b.y < 0) bullets.splice(i, 1);
      });
    }

    function drawEnemies() {
      ctx.fillStyle = "lime";
      enemies.forEach((e, ei) => {
        e.y += 2 + level * 0.2;
        ctx.fillRect(e.x, e.y, 30, 30);

        // Check collision with bullets
        bullets.forEach((b, bi) => {
          if (b.x < e.x + 30 && b.x + 5 > e.x && b.y < e.y + 30 && b.y + 10 > e.y) {
            enemies.splice(ei, 1);
            bullets.splice(bi, 1);
            score += 10;
            updateLevel();
          }
        });

        // Check collision with player (game over if hit)
        if (
          e.x < spaceship.x + spaceship.width &&
          e.x + 30 > spaceship.x &&
          e.y < spaceship.y + spaceship.height &&
          e.y + 30 > spaceship.y
        ) {
          collisionCount++;
          if (collisionCount >= 3) {
            gameOver();
          }
        }
      });
    }

    function drawPowerUps() {
      ctx.fillStyle = "cyan";
      powerUps.forEach((p, pi) => {
        p.y += 2;
        ctx.beginPath();
        ctx.arc(p.x, p.y, 8, 0, Math.PI * 2);
        ctx.fill();

        if (
          p.x > spaceship.x &&
          p.x < spaceship.x + spaceship.width &&
          p.y > spaceship.y &&
          p.y < spaceship.y + spaceship.height
        ) {
          if (p.type === "double") {
            powerUps.push("double");
          } else if (p.type === "triple") {
            powerUps.push("triple");
          }
          powerUps.splice(pi, 1); // Remove power-up after collection
        }
      });
    }

    function drawHealthPowerUps() {
      ctx.fillStyle = "yellow";
      healthPowerUps.forEach((p, pi) => {
        p.y += 2;
        ctx.beginPath();
        ctx.arc(p.x, p.y, 8, 0, Math.PI * 2);
        ctx.fill();

        if (
          p.x > spaceship.x &&
          p.x < spaceship.x + spaceship.width &&
          p.y > spaceship.y &&
          p.y < spaceship.y + spaceship.height
        ) {
          if (playerHealth < 3) playerHealth++;
          healthPowerUps.splice(pi, 1); // Remove health power-up after collection
        }
      });
    }

    function drawBoss() {
      if (!boss) return;
      ctx.fillStyle = "purple";
      ctx.fillRect(boss.x, boss.y, boss.width, boss.height);
      boss.y += 0.4;

      // Display boss health
      hud.innerText = `Score: ${score} | Level: ${level} | Boss Health: ${bossHealth} | Health: ${playerHealth}`;

      bullets.forEach((b, bi) => {
        if (
          b.x < boss.x + boss.width &&
          b.x + 5 > boss.x &&
          b.y < boss.y + boss.height &&
          b.y + 10 > boss.y
        ) {
          bullets.splice(bi, 1);
          bossHealth--;
          if (bossHealth <= 0) {
            boss = null;
            score += 100;
            level++;
            updateLevel();
          }
        }
      });

      // Check collision with player (game over if hit)
      if (
        boss.x < spaceship.x + spaceship.width &&
        boss.x + boss.width > spaceship.x &&
        boss.y < spaceship.y + spaceship.height &&
        boss.y + boss.height > spaceship.y
      ) {
        gameOver();
      }
    }

    function spawnEnemies() {
      if (level % 5 === 0 && !boss) {
        boss = {
          x: canvas.width / 2 - 100,
          y: 0,
          width: 200,
          height: 60
        };
        bossHealth = 30 + level * 5;
        return;
      }

      if (Math.random() < 0.02 + level * 0.001) {
        enemies.push({ x: Math.random() * (canvas.width - 30), y: 0 });
      }

      if (Math.random() < 0.003) {
        powerUps.push({ x: Math.random() * canvas.width, y: 0, type: "double" });
      }

      if (Math.random() < 0.003) {
        powerUps.push({ x: Math.random() * canvas.width, y: 0, type: "triple" });
      }

      if (Math.random() < 0.002) {
        healthPowerUps.push({ x: Math.random() * canvas.width, y: 0 });
      }
    }

    function updateLevel() {
      if (score >= level * 100) {
        level++;
      }
    }

    function gameOver() {
      alert("Game Over!");
      score = 0;
      level = 1;
      enemies = [];
      bullets = [];
      powerUps = [];
      healthPowerUps = [];
      boss = null;
      bossHealth = 0;
      collisionCount = 0;
      playerHealth = 3;
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawSpaceship();
      drawBullets();
      drawEnemies();
      drawPowerUps();
      drawHealthPowerUps();
      drawBoss();
      spawnEnemies();
      fireBullet();
      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>